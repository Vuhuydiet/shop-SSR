<div class="container py-4 flex items-center gap-3">
  <a href="/" class="text-primary text-base">
    <i class="fa-solid fa-house"></i>
  </a>
  <span class="text-sm text-gray-400">
    <i class="fa-solid fa-chevron-right"></i>
  </span>
  <p class="text-gray-600 font-medium">Account</p>
</div>

<!-- account wrapper -->
<div class="container grid grid-cols-12 items-start gap-6 pt-4 pb-16">
  <!-- sidebar -->
  <div class="col-span-3">
    <div class="px-4 py-3 shadow flex items-center gap-4">
      <div class="flex-shrink-0">
        <img
          src="../assets/images/avatar.png"
          alt="profile"
          class="rounded-full w-14 h-14 border border-gray-200 p-1 object-cover"
        />
      </div>
      <div class="flex-grow">
        <p class="text-gray-600">Hello,</p>
        <h4 class="text-gray-800 font-medium"><%= user.email %></h4>
      </div>
    </div>

    <div
      class="mt-6 bg-white shadow rounded p-4 divide-y divide-gray-200 space-y-4 text-gray-600"
    >
      <div class="space-y-1 pl-8">
        <a
          href="/profile"
          class="relative text-primary block font-medium capitalize transition"
        >
          <span class="absolute -left-8 top-0 text-base">
            <i class="fa-regular fa-address-card"></i>
          </span>
          Manage account
        </a>
        <a
          href="/profile/address"
          class="relative hover:text-primary block capitalize transition"
        >
          Manage addresses
        </a>
        <a
          href="./profile.html"
          class="relative hover:text-primary block capitalize transition"
        >
          Change password
        </a>
      </div>

      <div class="space-y-1 pl-8 pt-4">
        <a
          href="#"
          class="relative hover:text-primary block font-medium capitalize transition"
        >
          <span class="absolute -left-8 top-0 text-base">
            <i class="fa-solid fa-box-archive"></i>
          </span>
          My order history
        </a>
        <a
          href="#"
          class="relative hover:text-primary block capitalize transition"
        >
          My reviews
        </a>
      </div>

      <div class="space-y-1 pl-8 pt-4">
        <a
          href="/users/logout"
          class="relative hover:text-primary block font-medium capitalize transition"
        >
          <span class="absolute -left-8 top-0 text-base">
            <i class="fa-regular fa-arrow-right-from-bracket"></i>
          </span>
          Logout
        </a>
      </div>
    </div>
  </div>
  <!-- ./sidebar -->

  <!-- info -->
  <div class="col-span-9 px-4">
    <div class="px-2">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl uppercase font-medium">Your addresses</h2>
        <!-- Add Address Button -->
        <a
          href="/profile/address/add"
          class="inline-block bg-primary text-white px-4 py-2 rounded transition duration-200 hover:opacity-80 active:opacity-70 shadow-sm hover:shadow-md"
        >
          Add Address
        </a>
      </div>
    </div>

    <!-- Address List -->
    <div class="space-y-2 px-4 pt-4">
      <div class="sm:divide-y sm:divide-gray-600">
        <% addresses.forEach(address => { %>
        <div class="p-4 sm:py-5">
          <!-- Name, phone and buttons container -->
          <div class="flex items-center justify-between">
            <div class="text-lg font-medium text-gray-800">
              <b><%= address.recipientName %> | <%= address.phoneNumber %></b>
            </div>
            <div class="flex items-center space-x-4">
              <a
                href="/profile/address/edit/<%= address.addressId %>"
                class="text-blue-500 hover:text-blue-700 flex items-center"
              >
                <i class="fa-solid fa-pen mr-2"></i> Edit
              </a>
              <form
                action="/profile/address/delete/<%= address.addressId %>"
                method="POST"
                class="inline delete-address-form"
                data-address-id="<%= address.addressId %>"
              >
                <button
                  type="submit"
                  class="text-red-500 hover:text-red-600 flex items-center transition"
                >
                  <i class="fa-solid fa-trash mr-2"></i> Remove
                </button>
              </form>
            </div>
          </div>
          <!-- Address details -->
          <div class="mt-2 text-sm text-gray-900">
            <p class="text-lg"><%= address.detailAddress %></p>
            <p class="text-lg">
              <%= address.ward %>, <%= address.district %>, <%= address.city %>,
              <%= address.country %>
            </p>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </div>
</div>

<template id="address-template">
  <div class="p-4 sm:py-5">
    <div class="flex items-center justify-between">
      <div class="text-lg font-medium text-gray-800">
        <b><span data-recipient></span> | <span data-phone></span></b>
      </div>
      <div class="flex items-center space-x-4">
        <button
          data-edit
          class="text-blue-500 hover:text-blue-700 flex items-center"
        >
          <i class="fa-solid fa-pen mr-2"></i> Edit
        </button>
        <button
          data-delete
          class="text-red-500 hover:text-red-600 flex items-center transition"
        >
          <i class="fa-solid fa-trash mr-2"></i> Remove
        </button>
      </div>
    </div>
    <div class="mt-2 text-sm text-gray-900">
      <p class="text-lg" data-detail></p>
      <p class="text-lg" data-location></p>
    </div>
  </div>
</template>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const forms = document.querySelectorAll(".delete-address-form");

    forms.forEach((form) => {
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!confirm("Are you sure you want to delete this address?")) {
          return;
        }

        const addressId = form.dataset.addressId;

        try {
          const response = await fetch(`/profile/address/delete/${addressId}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const addressContainer = form.closest(".p-4");
            addressContainer.remove();
          } else {
            throw new Error("Failed to delete address");
          }
        } catch (error) {
          alert("Error deleting address: " + error.message);
        }
      });
    });
  });
</script>
